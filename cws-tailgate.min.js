angular.module("mongolabResourceHttp",[]).factory("$mongolabResourceHttp",["MONGOLAB_CONFIG","$http","$q",function(e,a,t){function r(r){var n=angular.extend({BASE_URL:"https://api.mongolab.com/api/1/databases/"},e),o=n.BASE_URL+n.DB_NAME,i=o+"/collections/"+r,l={apiKey:n.API_KEY},s=function(e){return new d(e)},c=function(e){for(var a=[],t=0;t<e.length;t++)a.push(new d(e[t]));return a},u=function(e,a,r,n){return e.then(function(e){var t=n(e.data);return(a||angular.noop)(t,e.status,e.headers,e.config),t},function(e){return(r||angular.noop)(void 0,e.status,e.headers,e.config),t.reject(e.data)})},m=function(e){return angular.isObject(e)&&!angular.equals(e,{})?{q:JSON.stringify(e)}:{}},d=function(e){angular.extend(this,e)};return d.query=function(e,t,r,n){var o=function(e){var a={sort:"s",limit:"l",fields:"f",skip:"sk"},t={};return e&&!angular.equals(e,{})&&angular.forEach(a,function(a,r){angular.isDefined(e[r])&&(t[a]=angular.isObject(e[r])?JSON.stringify(e[r]):e[r])}),t};angular.isFunction(t)&&(n=r,r=t,t={});var s=angular.extend({},l,m(e),o(t)),d=a.get(i,{params:s});return u(d,r,n,c)},d.all=function(e,a,t){return angular.isFunction(e)&&(t=a,a=e,e={}),d.query({},e,a,t)},d.count=function(e,t,r){var n=a.get(i,{params:angular.extend({},l,m(e),{c:!0})});return u(n,t,r,function(e){return e})},d.distinct=function(e,t,n,i){var s=a.post(o+"/runCommand",angular.extend({},t||{},{distinct:r,key:e}),{params:l});return u(s,n,i,function(e){return e.values})},d.getById=function(e,t,r){var n=a.get(i+"/"+e,{params:l});return u(n,t,r,s)},d.getByObjectIds=function(e,a,t){var r=[];return angular.forEach(e,function(e){r.push({$oid:e})}),d.query({_id:{$in:r}},a,t)},d.prototype.$id=function(){return this._id&&this._id.$oid?this._id.$oid:this._id?this._id:void 0},d.prototype.$save=function(e,t){var r=a.post(i,this,{params:l});return u(r,e,t,s)},d.prototype.$update=function(e,t){var r=a.put(i+"/"+this.$id(),angular.extend({},this,{_id:void 0}),{params:l});return u(r,e,t,s)},d.prototype.$remove=function(e,t){var r=a["delete"](i+"/"+this.$id(),{params:l});return u(r,e,t,s)},d.prototype.$saveOrUpdate=function(e,a,t,r){return this.$id()?this.$update(a,r):this.$save(e,t)},d}return r}]),function(e){try{e=angular.module("cws-tailgate-templates")}catch(a){e=angular.module("cws-tailgate-templates",[])}e.run(["$templateCache",function(e){e.put("/cws-tailgate/map/map.html",'<div class="alert-bar"><alert ng-repeat="alert in alerts | limitTo: 1" type="alert.type" close="closeAlert($index)">{{alert.msg}}</alert></div><small class="error" ng-hide="mapctrl.hasLocation">Unable to grab your current locaiton</small><div class="begin" ng-hide="mapctrl.selectedTeam"><div class="row"><div class="small-12 columns"><div class="panel"><p>Select A Team To Begin</p></div></div></div></div><div class="row"><div class="small-12 medium-4 columns end"><select ng-model="mapctrl.selectedTeam" ng-options="t as t for t in mapctrl.teams" ng-change="getTailGates()"><option value="">-- Select a Team--</option></select></div></div><div ng-if="mapctrl.selectedTeam"><div class="row"><google-map center="map.center" zoom="map.zoom" draggable="false" pan="true" class="small-12 large-12 columns end"><marker coords="currentLocationMarker.coords"><marker-label content="&quot;You are Here&quot;" anchor="0 0" class="tailgate-label"></marker-label></marker><marker coords="cwsMarker.coords" icon="cwsMarker.icon"><marker-label content="cwsMarker.label" anchor="0 0" class="tailgate-label"></marker-label></marker><marker coords="busMarker.coords" icon="busMarker.icon"><marker-label content="busMarker.label" anchor="0 0" class="bus-label"></marker-label></marker><markers models="mapctrl.tailgates" coords="\'coords\'" labelcontent="\'name\'" labelanchor="0 0" labelclass="tailgate-label" icon="\'icon\'" click="showDetails(m)"></markers></google-map></div><div class="row"><div class="small-12 medium-6 columns"><div class="panel primary add-team-form"><h2>{{mapctrl.selectedTeam}} Tailgate</h2><p class="alert-panel" ng-hide="mapctrl.tailgates">There are no Tailgate for {{mapctrl.selectedTeam}} yet. Be the first to start the party</p><div ng-repeat="tg in mapctrl.tailgates" class="tailgate-list">{{tg.name}} | {{tg.time | date}} | <a ng-click="removeLocation(tg)">Stop this bus</a></div></div></div><div class="small-12 medium-6 columns"><div class="panel primary add-team-form"><h2>Add Tailgate</h2><form name="form" novalidate=""><div class="row"><label>Name:<input type="text" ng-model="newTailGate.name" ng-required="true" placeholder="Give Your Tail Gate A Name" tab-index="0"></label></div><div class="row"><label>Team:<input type="text" ng-model="newTailGate.team" ng-required="true" placeholder="Your Favorite Team" tab-index="1" typeahead="team for team in mapctrl.teams | filter:$viewValue | limitTo:8" typeahead-editable="false"></label></div><div class="row"><label><input type="checkbox" ng-model="mapctrl.useCurrentLocation" ng-disabled="true">Use Current Location</label></div><div class="row"><button class="expand" ng-click="add(newTailGate)" ng-disabled="form.$invalid">Add Tail Gate</button></div></form></div></div></div></div>')}])}(),angular.module("cwsTailgate.map.service",["mongolabResourceHttp"]).constant("MONGOLAB_CONFIG",{API_KEY:"rQxsZ4OjiJ_6cxUf40Heixvdm8oZg0dT",DB_NAME:"cws-tail-gating"}).factory("cwsMapPoints",["$mongolabResourceHttp","$window","$q",function(e,a,t){var r=e("tailgates"),n=function(e){var e=e||"";return r.query({team:e})},o=function(e){e.useCurrentLocation&&delete e.useCurrentLocation;var a=new r(e);return a.$saveOrUpdate()},i=function(){var e=t.defer();return e.resolve(["UC-Irvine","Texas","Lousiville","Vanderbilt","Texas Tech","TCU","Virginia","Mississippi"]),e.promise},l=function(){var e=t.defer();return angular.isDefined(a.navigator.geolocation)?a.navigator.geolocation.getCurrentPosition(function(a){console.log("Got location -> ",a),e.resolve(a)},function(a){e.reject(a)}):(console.log("No geolocation"),e.reject("No geolocation available")),e.promise};return{get:n,getAllTeams:i,add:o,currentLocation:l}}]),angular.module("cwsTailgate.map.controller",["cwsTailgate.map.service","google-maps"]).controller("MapCtrl",["$scope","cwsMapPoints","$log",function(e,a,t){"use strict";e.alerts=[],e.closeAlert=function(a){e.alerts.splice(a,1)},e.map={center:{latitude:"41.1757071",longitude:"-96.01572449999999"},zoom:13},e.mapctrl={tailgates:[],currentLocation:{},useCurrentLocation:!0,teams:[],selectedTeam:"",hasLocation:!1},e.newTailGate={team:""},e.getTeams=function(){a.getAllTeams().then(function(a){e.mapctrl.teams=a},function(e){t.error(e)})},e.getTailGates=function(){e.newTailGate.team=e.mapctrl.selectedTeam,a.get(e.mapctrl.selectedTeam).then(function(a){for(var t=0;t<a.length;t++)a[t].id=t,a[t].icon||(a[t].icon="assets/beer.png");e.mapctrl.tailgates=a},function(e){t.error(e)})},e.removeLocation=function(a){a.$remove().then(function(){e.alerts.push({type:"success",msg:"The party is over."})},function(){e.alerts.push({type:"error",msg:"This party just wont stop"})}).then(e.getTailGates())},e.getCurrentLocation=function(){a.currentLocation().then(function(a){e.mapctrl.hasLocation=!0,e.mapctrl.currentLocation=a,e.currentLocationMarker=a,e.map.center=a.coords},function(a){e.mapctrl.currentLocation=e.busMarker,e.map.center=e.busMarker.coords,t.error(a)})},e.add=function(t){e.mapctrl.useCurrentLocation&&(t.coords=e.mapctrl.currentLocation.coords,t.time=e.mapctrl.currentLocation.timestamp),a.add(t).then(function(){e.newTailGate={team:e.mapctrl.selectedTeam},e.alerts.push({type:"success",msg:"Tailgate succesfully added!"})},function(a){e.alerts.push({type:"danger",msg:a})}).then(e.getTailGates())},e.cwsMarker={coords:{latitude:"41.2670",longitude:"-95.9320"},label:"CWS",position:"0 0",icon:"assets/star.png"},e.busMarker={coords:{latitude:"41.280636",longitude:"-95.912817"},label:"ULTRA MEGA PARTY BUS 1988-?",position:"0 0",icon:"assets/bus.png"},e.currentLocationMarker={coords:{}},e.getCurrentLocation(),e.getTeams()}]),angular.module("cwsTailgate.map",["cwsTailgate.map.controller","cwsTailgate.map.service"]),angular.module("cwsTailgate",["ngRoute","ngTouch","cwsTailgate.map","cws-tailgate-templates","mongolabResourceHttp","mm.foundation"]).config(["$routeProvider",function(e){"use strict";e.when("/map",{controller:"MapCtrl",templateUrl:"/cws-tailgate/map/map.html"}).otherwise({redirectTo:"/map"})}]);