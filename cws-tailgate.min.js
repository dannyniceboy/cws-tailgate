angular.module("mongolabResourceHttp",[]).factory("$mongolabResourceHttp",["MONGOLAB_CONFIG","$http","$q",function(e,t,a){function r(r){var n=angular.extend({BASE_URL:"https://api.mongolab.com/api/1/databases/"},e),o=n.BASE_URL+n.DB_NAME,i=o+"/collections/"+r,l={apiKey:n.API_KEY},s=function(e){return new d(e)},c=function(e){for(var t=[],a=0;a<e.length;a++)t.push(new d(e[a]));return t},u=function(e,t,r,n){return e.then(function(e){var a=n(e.data);return(t||angular.noop)(a,e.status,e.headers,e.config),a},function(e){return(r||angular.noop)(void 0,e.status,e.headers,e.config),a.reject(e.data)})},m=function(e){return angular.isObject(e)&&!angular.equals(e,{})?{q:JSON.stringify(e)}:{}},d=function(e){angular.extend(this,e)};return d.query=function(e,a,r,n){var o=function(e){var t={sort:"s",limit:"l",fields:"f",skip:"sk"},a={};return e&&!angular.equals(e,{})&&angular.forEach(t,function(t,r){angular.isDefined(e[r])&&(a[t]=angular.isObject(e[r])?JSON.stringify(e[r]):e[r])}),a};angular.isFunction(a)&&(n=r,r=a,a={});var s=angular.extend({},l,m(e),o(a)),d=t.get(i,{params:s});return u(d,r,n,c)},d.all=function(e,t,a){return angular.isFunction(e)&&(a=t,t=e,e={}),d.query({},e,t,a)},d.count=function(e,a,r){var n=t.get(i,{params:angular.extend({},l,m(e),{c:!0})});return u(n,a,r,function(e){return e})},d.distinct=function(e,a,n,i){var s=t.post(o+"/runCommand",angular.extend({},a||{},{distinct:r,key:e}),{params:l});return u(s,n,i,function(e){return e.values})},d.getById=function(e,a,r){var n=t.get(i+"/"+e,{params:l});return u(n,a,r,s)},d.getByObjectIds=function(e,t,a){var r=[];return angular.forEach(e,function(e){r.push({$oid:e})}),d.query({_id:{$in:r}},t,a)},d.prototype.$id=function(){return this._id&&this._id.$oid?this._id.$oid:this._id?this._id:void 0},d.prototype.$save=function(e,a){var r=t.post(i,this,{params:l});return u(r,e,a,s)},d.prototype.$update=function(e,a){var r=t.put(i+"/"+this.$id(),angular.extend({},this,{_id:void 0}),{params:l});return u(r,e,a,s)},d.prototype.$remove=function(e,a){var r=t["delete"](i+"/"+this.$id(),{params:l});return u(r,e,a,s)},d.prototype.$saveOrUpdate=function(e,t,a,r){return this.$id()?this.$update(t,r):this.$save(e,a)},d}return r}]),function(e){try{e=angular.module("cws-tailgate-templates")}catch(t){e=angular.module("cws-tailgate-templates",[])}e.run(["$templateCache",function(e){e.put("/cws-tailgate/map/map.html",'<div class="alert-bar"><alert ng-repeat="alert in alerts | limitTo: 1" type="alert.type" close="closeAlert($index)">{{alert.msg}}</alert></div><small class="error" ng-hide="mapctrl.hasLocation">Unable to grab your current locaiton</small><div class="row"><div class="small-12 medium-6 medium-centered columns"><div class="panel"><h2>Team</h2><div class="row"><select ng-model="mapctrl.selectedTeam" ng-options="t as t for t in mapctrl.teams" ng-change="getTailGates()"><option value="">-- Select a Team--</option></select></div></div></div></div><div ng-if="mapctrl.selectedTeam"><div class="row"><google-map center="map.center" zoom="map.zoom" draggable="true" pan="true" control="map.control" events="map.events" options="map.options"><marker coords="currentLocationMarker.coords"><marker-label content="&quot;You are Here&quot;" anchor="0 0" class="tailgate-label"></marker-label></marker><marker coords="cwsMarker.coords" icon="cwsMarker.icon"><marker-label content="cwsMarker.label" anchor="0 0" class="tailgate-label"></marker-label></marker><marker coords="busMarker.coords" icon="busMarker.icon"><marker-label content="busMarker.label" anchor="0 0" class="bus-label"></marker-label></marker><markers models="mapctrl.tailgates" coords="\'coords\'" labelcontent="\'name\'" labelanchor="0 0" labelclass="tailgate-label" icon="\'icon\'" click="showDetails(m)"></markers></google-map></div><div class="row"><div class="small-12 medium-6 columns"><div class="panel primary add-team-form"><h2>{{mapctrl.selectedTeam}} Tailgate</h2><p class="alert-panel" ng-hide="mapctrl.tailgates">There are no Tailgate for {{mapctrl.selectedTeam}} yet. Be the first to start the party</p><div ng-repeat="tg in mapctrl.tailgates" class="tailgate-list">{{tg.name}} | {{tg.time | date}} | <a ng-click="removeLocation(tg)">Stop this bus</a></div></div></div><div class="small-12 medium-6 columns"><div class="panel primary add-team-form"><h2>Add Tailgate</h2><form name="form" novalidate=""><div class="row"><label>Name:<input type="text" ng-model="newTailGate.name" ng-required="true" placeholder="Give Your Tail Gate A Name" tab-index="0"></label></div><div class="row"><label>Team:<input type="text" ng-model="newTailGate.team" ng-required="true" placeholder="Your Favorite Team" tab-index="1" typeahead="team for team in mapctrl.teams | filter:$viewValue | limitTo:8" typeahead-editable="false"></label></div><div class="row"><label><input type="checkbox" ng-model="mapctrl.useCurrentLocation" ng-disabled="true">Use Current Location</label></div><div class="row"><button class="expand" ng-click="add(newTailGate)" ng-disabled="form.$invalid">Add Tail Gate</button></div></form></div></div></div></div>')}])}(),angular.module("cwsTailgate.map.service",["mongolabResourceHttp"]).constant("MONGOLAB_CONFIG",{API_KEY:"rQxsZ4OjiJ_6cxUf40Heixvdm8oZg0dT",DB_NAME:"cws-tail-gating"}).factory("cwsMapPoints",["$mongolabResourceHttp","$window","$q",function(e,t,a){var r=e("tailgates"),n=function(e){var e=e||"";return r.query({team:e})},o=function(e){e.useCurrentLocation&&delete e.useCurrentLocation;var t=new r(e);return t.$saveOrUpdate()},i=function(){var e=a.defer();return e.resolve(["UC-Irvine","Texas","Lousiville","Vanderbilt","Texas Tech","TCU","Virginia","Mississippi"]),e.promise},l=function(){var e=a.defer();return angular.isDefined(t.navigator.geolocation)?t.navigator.geolocation.getCurrentPosition(function(t){console.log("Got location -> ",t),e.resolve(t)},function(t){e.reject(t)}):(console.log("No geolocation"),e.reject("No geolocation available")),e.promise};return{get:n,getAllTeams:i,add:o,currentLocation:l}}]),angular.module("cwsTailgate.map.controller",["cwsTailgate.map.service","google-maps"]).controller("MapCtrl",["$scope","cwsMapPoints","$log","$tour",function(e,t,a,r){"use strict";e.alerts=[],e.closeAlert=function(t){e.alerts.splice(t,1)},e.map={center:{latitude:"41.1757071",longitude:"-96.01572449999999"},zoom:13,control:{},events:{tilesloaded:function(t){e.$apply(function(){a.info("this is the map instance",t)})}},options:{panControl:!0}},e.mapctrl={tailgates:[],currentLocation:{},useCurrentLocation:!0,teams:[],selectedTeam:"",hasLocation:!1},e.newTailGate={team:""},e.getTeams=function(){t.getAllTeams().then(function(t){e.mapctrl.teams=t},function(e){a.error(e)})},e.getTailGates=function(){e.newTailGate.team=e.mapctrl.selectedTeam,t.get(e.mapctrl.selectedTeam).then(function(t){for(var a=0;a<t.length;a++)t[a].id=a,t[a].icon||(t[a].icon="assets/beer.png");e.mapctrl.tailgates=t},function(e){a.error(e)})},e.removeLocation=function(t){t.$remove().then(function(){e.alerts.push({type:"success",msg:"The party is over."}),e.getTailGates()},function(){e.alerts.push({type:"error",msg:"This party just wont stop"})})},e.getCurrentLocation=function(){t.currentLocation().then(function(t){e.mapctrl.hasLocation=!0,e.mapctrl.currentLocation=t,e.currentLocationMarker=t,e.map.center=t.coords},function(t){angular.copy(e.busMarker,e.mapctrl.currentLocation),angular.copy(e.mapctrl.currentLocation,e.busMarker),e.map.center={latitude:e.busMarker.coords.latitude,longitude:e.busMarker.coords.longitude},a.error(t)})},e.add=function(a){e.mapctrl.useCurrentLocation&&(a.coords=e.mapctrl.currentLocation.coords,a.time=e.mapctrl.currentLocation.timestamp),t.add(a).then(function(){e.newTailGate={team:e.mapctrl.selectedTeam},e.alerts.push({type:"success",msg:"Tailgate succesfully added!"}),e.getTailGates()},function(t){e.alerts.push({type:"danger",msg:t})})},e.cwsMarker={coords:{latitude:"41.2670",longitude:"-95.9320"},label:"CWS",position:"0 0",icon:"assets/star.png"},e.busMarker={coords:{latitude:"41.280636",longitude:"-95.912817"},label:"ULTRA MEGA PARTY BUS 1988-?",position:"0 0",icon:"assets/bus.png"},e.currentLocationMarker={coords:{}},e.getCurrentLocation(),e.getTeams(),r.start()}]),angular.module("cwsTailgate.map",["cwsTailgate.map.controller","cwsTailgate.map.service"]),angular.module("cwsTailgate",["ngRoute","ngTouch","cwsTailgate.map","cws-tailgate-templates","mongolabResourceHttp","mm.foundation"]).config(["$routeProvider",function(e){"use strict";e.when("/map",{controller:"MapCtrl",templateUrl:"/cws-tailgate/map/map.html"}).otherwise({redirectTo:"/map"})}]);